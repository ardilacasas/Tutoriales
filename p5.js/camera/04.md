# 4. Detectar caras

¿Cómo detectar objetos de un color especifico en la pantalla? El código de este ejemplo se puede ver [acá](https://editor.p5js.org/laurajunco/sketches/SJ3L5F_hX).

### a. Incluir librería para detectar caras <a id="a-incluir-libreria-para-detectar-colores"></a>

Para este Ejemplo se utilizará la librería [tracking.js](https://trackingjs.com/) la cual permite detectar colores y rostros en imágenes o videos.

* Descargar la librería de [este enlace](https://github.com/eduardolundgren/tracking.js/archive/master.zip)​
* Agregar los archivos  **tracking.js**  y **face.js** al sketch de p5.js
* Agregar links en el archivo **index.html**

```markup
<script src="tracking.js"> </script>
<script src="face.js"> </script>
```

### b. Mostrar la imagen de captura en la misma posición del canvas <a id="b-mostrar-la-imagen-de-captura-en-la-misma-posicion-del-canvas"></a>

Para la librería es necesario que el elemento de captura exista. Por lo tanto, en este ejemplo no es posible utilizar **capture.hide\(\).** Sin embargo, es posible alinear la captura de la cámara y el canvas en una misma posición

* Crear un elemento contenedor para el video y el canvas en **index.html**.

```markup
<div id="container"></div>
```

El archivo **index.html** debería verse de esta manera:

```markup
<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/addons/p5.dom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/addons/p5.sound.min.js"></script>
		<script src="tracking.js"></script>
    <script src="face.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8" />
  </head>
  
  <body>
    <div id="container"></div>
    <script src="sketch.js"></script>
  </body>
</html>

```

* Agregar la captura y el canvas al mismo elemento en **setup\(\)**.

```javascript
 //incluye la captura y el canvas dentro del elemento 'container'  
 capture.parent('container');   
 canvas.parent('container'); 
```

* Por último, editar el archivo **style.css** y agregar las siguientes lineas:

```css
#container {    
    position: relative;
}​

canvas, video {  
    width: 100%;  
    height: 100%;  
    position: absolute;  
    top: 0;  
    left: 0;
}
```

Este código modifica los estilos de los elementos de la página para que el video y el canvas queden en **la misma posición** en la pantalla

### c. Inicializar el tracking  <a id="c-inicializar-el-tracking"></a>

* Crear una función donde se realizará la detección de caras y ejecutarla en **setup\(\)**

```javascript
//esta función activa el tracking y encuentra el color seleccionado
function activarTracking() {

}
```

```javascript
function setup() {

    activarTracking();
}
```

* Crear un tracker para detectar caras

Es necesario crear una variable para guardar un objeto de tracking

```text
// variable para guardar el tracker de color
var tracker;
```

* Inicializar el objeto como un tracker de caras

```javascript
//crea un tracker de caras
tracker = new tracking.ColorTracker(['face']);
```

* Es necesario especificar el elemento especifico que se analizará, en este caso: la captura de la cámara.

```javascript
//utilizar el tracker de color en la captura de la camara
tracking.track('video', tracker);
```

### d. Detectar caras <a id="d-detectar-color"></a>

Cada vez que el tracker reconoce un grupo de pixeles como una cara **lanza un evento** al cual se puede acceder con la función **tracker.on\( 'track' \).**

```text
tracker.on('track', function (event) {​}
```

* Acceder a la información del evento y recorrer la lista de caras encontradas

```javascript
tracker.on('track', function (event) {    
     //recorre la lista de grupos encontrados    
     event.data.forEach(function (r) {
     }
}
```

**event.data** es la función que permite acceder a a la información que obtiene el tracker. Este evento retorna una lista de grupos de pixeles. Cada grupo de pixeles\(r\) tiene las siguientes características:

1. **r.x** = posición en x del grupo de pixeles
2. **r.y** = posición en y del grupo de pixeles
3. **r.height** = altura maxima del grupo de pixeles
4. **r.width** = anchura máxima del grupo de pixeles

* Imprimir los datos de cada evento

```text
tracker.on('track', function (event) {​    
  
}
```

### e. Dibujar con el color seleccionado <a id="e-dibujar-con-el-color-seleccionado"></a>

* Crear variables para la posición de la elipse que se dibujará:

```text
//variables de posición para pintar una elipsevar x; var y;
```

* Utilizar los valores obtenidos del tracking para actualizar la posición de la elipse

```text
tracker.on('track', function (event) {​    //recorre la lista de grupos encontrados    event.data.forEach(function (r) {            //calcula el centro del cuadro y actualiza los valores de X y Y        x = r.x + (r.width/2);        y = r.y + (r.height/2);    }}
```

* pintar una elipse con las coordenadas obtenidas

```text
function draw() {​  //se pinta una elipse con las dimensiones y el lugar recibido  fill(255, 255, 0);  noStroke();    //se utiliza width - x para dibujar en espejo  ellipse(width - x, y, 15, 15);​}
```

* Por último ocultar el video y dejar un canvas en blanco

Para ocultar el video en este ejemplo \(ya que no se puede ocultar la captura sin que **tracking.js** deje de funcionar\) se utilizará un estilo en el archivo **style.css**

```text
video {  visibility: hidden;}
```

**Visibility: hidden** hace un elemento de html invisible sin necesidad de eliminarlo

* Borrar el canvas al hacer click

```text
function mousePressed() {​    //borra el canvas    clear();    }
```

**Clear\(\)** elimina todo el contenido del canvas

